<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Azure B2C - itsme OIDC Documentation</title> <link rel="shortcut icon" href="/doc/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/doc/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/doc/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/doc/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Azure B2C | itsme OIDC Documentation</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="Azure B2C" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Prerequisites" /> <meta property="og:description" content="Prerequisites" /> <link rel="canonical" href="https://belgianmobileid.github.io/doc/azureB2C/" /> <meta property="og:url" content="https://belgianmobileid.github.io/doc/azureB2C/" /> <meta property="og:site_name" content="itsme OIDC Documentation" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-06-11T02:15:52+00:00" /> <script type="application/ld+json"> {"description":"Prerequisites","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://belgianmobileid.github.io/doc/public/images/ASMARTERWAY_RGB.png"}},"headline":"Azure B2C","dateModified":"2024-06-11T02:15:52+00:00","datePublished":"2024-06-11T02:15:52+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://belgianmobileid.github.io/doc/azureB2C/"},"url":"https://belgianmobileid.github.io/doc/azureB2C/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="../public/css/custom.css"> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://belgianmobileid.github.io/doc/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item"><a href="/doc/index" class="nav-list-link">Home</a></li> </ul> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belgianmobileid.github.io/doc/IAM/" class="nav-list-link">IAM</a><ul class="nav-list"><li class="nav-list-item active"><a href="#what-is-an-iam-platform" class="nav-list-link">What is an IAM platform?</a></li><li class="nav-list-item active"><a href="#integrating-itsme-on-an-iam-platform" class="nav-list-link">Integrating itsme® on an IAM platform</a></li><li class="nav-list-item active"><a href="#list-of-platforms" class="nav-list-link">List of platforms</a></li></ul> </li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belgianmobileid.github.io/doc/auth0/" class="nav-list-link">Auth0</a><ul class="nav-list"><li class="nav-list-item active"><a href="#prerequisites" class="nav-list-link">Prerequisites</a></li><li class="nav-list-item active"><a href="#configuration-between-auth0-and-itsme" class="nav-list-link">Configuration between Auth0 and itsme®</a></li><li class="nav-list-item active"><a href="#reference" class="nav-list-link">Reference</a></li></ul> </li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belgianmobileid.github.io/doc/aws/" class="nav-list-link">AWS Cognito</a><ul class="nav-list"><li class="nav-list-item active"><a href="#prerequisites" class="nav-list-link">Prerequisites</a></li><li class="nav-list-item active"><a href="#configuration-between-aws-and-itsme" class="nav-list-link">Configuration between AWS and itsme®</a></li><li class="nav-list-item active"><a href="#reference" class="nav-list-link">Reference</a></li></ul> </li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belgianmobileid.github.io/doc/azureB2C/" class="nav-list-link active">Azure B2C</a><ul class="nav-list"><li class="nav-list-item active"><a href="#prerequisites" class="nav-list-link">Prerequisites</a></li><li class="nav-list-item active"><a href="#configuration-between-azure-b2c-and-itsme" class="nav-list-link">Configuration between Azure B2C and itsme®</a></li><li class="nav-list-item active"><a href="#reference" class="nav-list-link">Reference</a></li></ul> </li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belgianmobileid.github.io/doc/forgerock/" class="nav-list-link">Forgerock | Ping Identity</a> </li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belgianmobileid.github.io/doc/okta/" class="nav-list-link">Okta</a> </li></ul> </nav> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search itsme OIDC Documentation" aria-label="Search itsme OIDC Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h2 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h2> <ul> <li>Azure B2C account and/or relevant subscription</li> <li>Your Client ID, also known as Partner code, provided by itsme®.</li> <li>Your Service code provided by itsme®.</li> <li>Client secret provided by itsme®</li> <li>redirect_uri you will be redirecting the user to. In Azure B2C, it is in the following format (please, provide it to onboarding@itsme-id.com): <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://{partnerAzureB2C-tenant-name}.b2clogin.com/{partnerAzureB2C-tenant-name}/oauth2/authresp
https://{partnerAzureB2C-tenant-name}.b2clogin.com/{partnerAzureB2C-tenant-name}.onmicrosoft.com/oauth2/authresp
</code></pre></div> </div> </li> </ul> <h2 id="configuration-between-azure-b2c-and-itsme"> <a href="#configuration-between-azure-b2c-and-itsme" class="anchor-heading" aria-labelledby="configuration-between-azure-b2c-and-itsme"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration between Azure B2C and itsme® </h2> <p>Whether your set-up is via user flow (normally, via graphical user-interface (GUI) on Azure portal) or Identity Experience Framework (IEF), custom policies, configured via .xml files, will depend what ID data you wish (and entitled by commercial &amp; legal agreements) to receive.</p> <p>As of 2023, Azure B2C technical limitation is no possibility to process JSON objects, only strings. Please, cosult <button type="button"><a href="https://belgianmobileid.github.io/doc/IAM/" target="blank">this page</a></button> to see what claims returned by itsme® are strings or JSON object data type. User flow is limited to sub, names &amp; email. While IEF will allow you to process the rest of ID Data listed above in data type string.</p> <h3 id="user-flows"> <a href="#user-flows" class="anchor-heading" aria-labelledby="user-flows"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User Flows </h3> <p>User flows is a portal (GUI) configurable flow, which is based on built-in user attributes (values collected on sign up) and application claims, which are values about the user, returned to the application in the token. One can create custom attributes, but Azure B2C does not process any claims from itsme®, except the ones mapped during general idp setup (idp claims mapping), i.e. sub, given_name, family_name, email. Only those were returned consistently during testing of 2023.</p> <p>End-user will see in the app request to approve all data which is mentioned on the scope, e.g. if full scope defined =&gt; all data will be displayed to approve, but Azure B2C will process and return only mapped claims, i.e. sub, given_name, family_name, emails (returned as string collection).</p> <h3 id="identity-experience-framework-ief-or-custom-policy"> <a href="#identity-experience-framework-ief-or-custom-policy" class="anchor-heading" aria-labelledby="identity-experience-framework-ief-or-custom-policy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Identity Experience Framework (IEF) or custom policy </h3> <p>IEF is advanced method to configure Azure B2C via .xml files. Due to Azure B2C limitations, JSON Objects returned by itsme® can not be processed or transformed by Azure B2C, thus one could ask &amp; receive data which is returned as strings only.</p> <h4 id="ief-configuration-to-retrieve-custom-oidc-claims-string-or-boolean-data-type"> <a href="#ief-configuration-to-retrieve-custom-oidc-claims-string-or-boolean-data-type" class="anchor-heading" aria-labelledby="ief-configuration-to-retrieve-custom-oidc-claims-string-or-boolean-data-type"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> IEF configuration to retrieve custom OIDC claims (string or boolean data type) </h4> <p>Microsoft has elaborate documentation custom policy definition and how to work with <button type="button"><a href="https://learn.microsoft.com/en-us/azure/active-directory-b2c/custom-policy-overview#custom-policy-starter-pack" target="blank">starter pack</a></button>. Below we attempt to provide guidance from partner perspective to smooth the configuration flow. We advise however always fall back to Azure B2C official documentation.</p> <h5 id="prerequisites-1"> <a href="#prerequisites-1" class="anchor-heading" aria-labelledby="prerequisites-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h5> <ul> <li>An Azure B2C Tenant</li> <li>Your itsme® provided ClientID aka PartnerCode</li> <li>Your itsme® provided ServiceCode</li> <li>Your client secret for your itsme® account</li> </ul> <h4 id="getting-started-with-custom-policies"> <a href="#getting-started-with-custom-policies" class="anchor-heading" aria-labelledby="getting-started-with-custom-policies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting started with Custom Policies </h4> <h5 id="add-signing-and-encryption-keys"> <a href="#add-signing-and-encryption-keys" class="anchor-heading" aria-labelledby="add-signing-and-encryption-keys"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Add Signing and Encryption keys </h5> <p>Open the B2C tenant and, under Policies, select Identity Experience Framework.</p> <h5 id="create-the-signing-key"> <a href="#create-the-signing-key" class="anchor-heading" aria-labelledby="create-the-signing-key"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create the signing key </h5> <ol> <li>Select Policy Keys and then select Add.</li> <li>For Options, choose Generate.</li> <li>In Name, enter TokenSigningKeyContainer. The prefix B2C_1A_ is added automatically.</li> <li>For Key type, select RSA.</li> <li>For Key usage, select Signature.</li> <li>Select Create.</li> </ol> <h5 id="create-the-encryption-key"> <a href="#create-the-encryption-key" class="anchor-heading" aria-labelledby="create-the-encryption-key"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create the encryption key </h5> <ol> <li>Select Policy Keys and then select Add.</li> <li>For Options, choose Generate.</li> <li>In Name, enter TokenEncryptionKeyContainer. The prefix B2C_1A_ is added automatically.</li> <li>For Key type, select RSA.</li> <li>For Key usage, select Encryption.</li> <li>Select Create.</li> </ol> <h5 id="register-identity-experience-framework-applications"> <a href="#register-identity-experience-framework-applications" class="anchor-heading" aria-labelledby="register-identity-experience-framework-applications"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Register Identity Experience Framework applications </h5> <ol> <li>Open the B2C tenant and select under Manage App registrations.</li> <li>Select App registrations, and then select New registration.</li> <li>For Name, enter IdentityExperienceFramework.</li> <li>Under Supported account types, select Accounts in this organizational directory only.</li> <li>Under Redirect URI, select Web, and then enter https://your-tenant-name.b2clogin.com/your-tenant-name.onmicrosoft.com, where your-tenant-name is your Azure AD B2C tenant domain name.</li> <li>Under Permissions, select the Grant admin consent to openid and offline_access permissions check box.</li> <li>Select Register.</li> <li>Record the Application (client) ID for use in a later step.</li> </ol> <p>Next, expose the API by adding a scope:</p> <ol> <li>Under Manage, select Expose an API.</li> <li>Select Add a scope, then select Save and continue to accept the default application ID URI.</li> <li>Enter the following values to create a scope that allows custom policy execution in your Azure AD B2C tenant: <ul> <li>Scope name: user_impersonation</li> <li>Admin consent display name: Access IdentityExperienceFramework</li> <li>Admin consent description: Allow the application to access IdentityExperienceFramework on behalf of the signed-in user.</li> </ul> </li> <li>Select Add scope</li> </ol> <h5 id="register-the-proxyidentityexperienceframework-application"> <a href="#register-the-proxyidentityexperienceframework-application" class="anchor-heading" aria-labelledby="register-the-proxyidentityexperienceframework-application"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Register the ProxyIdentityExperienceFramework application </h5> <p>(cf. <button type="button"><a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/custom-policy-get-started?tabs=app-reg-preview#register-the-proxyidentityexperienceframework-application" target="blank">register proxy IEF app</a></button>)</p> <ol> <li>Open the B2C tenant and select under Manage App registrations.</li> <li>Select App registrations (Preview), and then select New registration.</li> <li>For Name, enter ProxyIdentityExperienceFramework.</li> <li>Under Supported account types, select Accounts in this organizational directory only.</li> <li>Under Redirect URI, use the drop-down to select Public client/native (mobile &amp; desktop).</li> <li>For Redirect URI, enter myapp://auth.</li> <li>Under Permissions, select the Grant admin consent to openid and offline_access permissions check box.</li> <li>Select Register.</li> <li>Record the Application (client) ID for use in a later step.</li> </ol> <p>Next, specify that the application should be treated as a public client:</p> <ol> <li>Under Manage, select Authentication.</li> <li>Select Try out the new experience (if shown).</li> <li>Under Advanced settings, enable Treat application as a public client (select Yes). Ensure that ”allowPublicClient”: true is set in the application manifest.</li> <li>Select Save.</li> </ol> <p>Now, grant permissions to the API scope you exposed earlier in the IdentityExperienceFramework registration:</p> <ol> <li>Under Manage, select API permissions.</li> <li>Under Configured permissions, select Add a permission.</li> <li>Select the My APIs tab, then select the IdentityExperienceFramework application.</li> <li>Under Permission, select the user_impersonation scope that you defined earlier.</li> <li>Select Add permissions. As directed, wait a few minutes before proceeding to the next step.</li> <li>Select Grant admin consent for (your tenant name).</li> <li>Select your currently signed-in administrator account, or sign in with an account in your Azure AD B2C tenant that’s been assigned at least the Cloud application administrator role.</li> <li>Select Accept.</li> <li>Select Refresh, and then verify that “Granted for …” appears under Status for the scopes - offline_access, openid and user_impersonation. It might take a few minutes for the permissions to propagate.</li> </ol> <h5 id="app-registration"> <a href="#app-registration" class="anchor-heading" aria-labelledby="app-registration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> App Registration </h5> <ol> <li>Open the B2C tenant and select under Manage select App Registrations</li> <li>New registration</li> <li>Support account type: Account in this organizational directory only</li> <li>Redirect URL: the redirect URL to your app. <ul> <li>For testing purposes, you can use https://jwt.ms</li> </ul> </li> <li>click on Register <ul> <li>For testing purposes, go to Authentication and select in the section implicit grant “Access Tokens” and “ID Tokens”.</li> </ul> </li> </ol> <h5 id="client-secret-registration"> <a href="#client-secret-registration" class="anchor-heading" aria-labelledby="client-secret-registration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Client Secret Registration </h5> <ol> <li>Open the B2C tenant and select under Policies Identity Experience Framework.</li> <li>Select Policy keys and then select Add.</li> <li>For Options, choose Manual.</li> <li>Enter the name “itsmeClientSecret”</li> <li>For Key usage, select Signature.</li> <li>Select Create.</li> </ol> <h4 id="edit-the-custom-policy-starter-pack"> <a href="#edit-the-custom-policy-starter-pack" class="anchor-heading" aria-labelledby="edit-the-custom-policy-starter-pack"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Edit the Custom Policy Starter Pack </h4> <ol> <li>Download the starter pack:</li> </ol> <p><code class="language-plaintext highlighter-rouge">git clone https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack</code></p> <ol> <li>Edit the files from the “SocialAndLocalAccounts” folder in the downloaded starter pack</li> <li>In all XML files in the starter pack, replace “yourtenant” with the name of your tenant</li> <li>In TrustFrameworkExtensions.xml, fill in the AppID of the two Identity Experience Framework applications <ul> <li>replace “ProxyIdentityExperienceFrameworkAppId”</li> <li>replace “IdentityExperienceFrameworkAppId”</li> <li>remove the “<ClaimsProvider>” with the DisplayName ‘Facebook’</ClaimsProvider></li> </ul> </li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Metadata&gt;
 &lt;Item Key="client_id"&gt;ProxyIdentityExperienceFrameworkAppID&lt;/Item&gt;
 &lt;Item Key="IdTokenAudience"&gt;IdentityExperienceFrameworkAppID&lt;/Item&gt;
&lt;/Metadata&gt;
&lt;InputClaims&gt;
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;InputClaim ClaimTypeReferenceId="client_id" DefaultValue="ProxyIdentityExperienceFrameworkID" /&gt;
 &lt;InputClaim ClaimTypeReferenceId="resource_id" PartnerClaimType="resource" DefaultValue="IdentityExperienceFrameworkAppID" /&gt;
&lt;/InputClaims&gt;
</code></pre></div></div> <h4 id="edit-the-trustframeworkbasexml-to-add-the-itsme-provider"> <a href="#edit-the-trustframeworkbasexml-to-add-the-itsme-provider" class="anchor-heading" aria-labelledby="edit-the-trustframeworkbasexml-to-add-the-itsme-provider"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Edit the Trustframeworkbase.xml to add the itsme provider </h4> <ol> <li>In the <ContentDefinitions> element, adjust the URIs for the layout if needed</ContentDefinitions></li> <li>In the <ClaimsProviders> element, remove the ClaimsProvider with the displayName facebook.com</ClaimsProviders></li> <li>Add in the <ClaimsProviders> element the following <ClaimsProvider> element. </ClaimsProvider></ClaimsProviders> <ul> <li>the METADATA depends on the environment:</li> </ul> <ul> <li>E2E: <code class="language-plaintext highlighter-rouge">https://oidc.e2e.itsme.services/clientsecret-oidc/csapi/v0.1/.well-known/openid-configuration</code></li> <li>PRD: <code class="language-plaintext highlighter-rouge">https://oidc.prd.itsme.services/clientsecret-oidc/csapi/v0.1/.well-known/openid-configuration</code></li> </ul> </li> </ol> <ul> <li>Replace YOURitsmePARTNERCODE with your itsme partner code</li> <li>Replace YOURitsmeSERVICECODE with your itsme service code In this example, the BENationalNumber claim is added as string and phone_number_verified as boolean. More claims can be added if needed:</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;ClaimsProvider&gt;
      &lt;DisplayName&gt;tsme®&lt;/DisplayName&gt;
      &lt;TechnicalProfiles&gt;
        &lt;TechnicalProfile Id="ItsmeProfile"&gt;
          &lt;DisplayName&gt;itsme®&lt;/DisplayName&gt;
          &lt;Protocol Name="OpenIdConnect" /&gt;
          &lt;Metadata&gt;
            &lt;Item Key="METADATA"&gt;https://oidc.e2e.itsme.services/clientsecret-oidc/csapi/v0.1/.well-known/openid-configuration&lt;/Item&gt;
            &lt;Item Key="client_id"&gt;YOURitsmePARTNERCODE&lt;/Item&gt;
            &lt;Item Key="response_types"&gt;code&lt;/Item&gt;
            &lt;Item Key="response_mode"&gt;query&lt;/Item&gt;
            &lt;Item Key="scope"&gt;openid service:YOURitsmeSERVICECODE&lt;/Item&gt;
            &lt;!-- Policy Engine Clients --&gt;
            &lt;Item Key="UsePolicyInRedirectUri"&gt;false&lt;/Item&gt;
            &lt;Item Key="HttpBinding"&gt;POST&lt;/Item&gt;
          &lt;/Metadata&gt;
          &lt;CryptographicKeys&gt;
            &lt;Key Id="client_secret" StorageReferenceId="B2C_1A_ItsmeClientSecret"/&gt;
          &lt;/CryptographicKeys&gt;
          &lt;InputClaims&gt;
            &lt;InputClaim ClaimTypeReferenceId="claims" DefaultValue="{&amp;quot;userinfo&amp;quot;:{&amp;quot;http://itsme.services/v2/claim/BENationalNumber&amp;quot;:null,&amp;quot;phone_number_verified&amp;quot;:null}}" AlwaysUseDefaultValue="true" /&gt;
          &lt;/InputClaims&gt;
          &lt;OutputClaims&gt;
            &lt;OutputClaim ClaimTypeReferenceId="identityProvider" DefaultValue="itsme-id.com" AlwaysUseDefaultValue="true" /&gt;
            &lt;OutputClaim ClaimTypeReferenceId="issuerUserId" PartnerClaimType="sub" /&gt;
            &lt;OutputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="given_name" /&gt;
            &lt;OutputClaim ClaimTypeReferenceId="surname" PartnerClaimType="family_name" /&gt;
            &lt;OutputClaim ClaimTypeReferenceId="displayName" PartnerClaimType="name" /&gt;
            &lt;OutputClaim ClaimTypeReferenceId="email" PartnerClaimType="email" /&gt;
            &lt;OutputClaim ClaimTypeReferenceId="extension_BENationalNumber" PartnerClaimType="http://itsme.services/v2/claim/BENationalNumber" /&gt;
            &lt;OutputClaim ClaimTypeReferenceId="extension_phoneNumberVerified" PartnerClaimType="phone_number_verified" DefaultValue="false" /&gt;
          &lt;/OutputClaims&gt;
          &lt;UseTechnicalProfileForSessionManagement ReferenceId="SM-SocialLogin" /&gt;
        &lt;/TechnicalProfile&gt;
      &lt;/TechnicalProfiles&gt;
    &lt;/ClaimsProvider&gt;
</code></pre></div></div> <ol> <li>Add in the section <code class="language-plaintext highlighter-rouge">&lt;ClaimsSchema&gt;</code> element the following <code class="language-plaintext highlighter-rouge">&lt;ClaimType&gt;</code> element:</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;ClaimType Id="claims"&gt;
  &lt;DisplayName&gt;Custom Claims&lt;/DisplayName&gt;
  &lt;DataType&gt;string&lt;/DataType&gt;
&lt;/ClaimType&gt;
</code></pre></div></div> <ol> <li>Adjust the <code class="language-plaintext highlighter-rouge">&lt;UserJourneys&gt;</code> elements to suit your needs. For example, replace the <code class="language-plaintext highlighter-rouge">&lt;ClaimsProviderSelection TargetClaimsExchangeId="FacebookExchange"/&gt;</code> with <code class="language-plaintext highlighter-rouge">&lt;ClaimsProviderSelection TargetClaimsExchangeId="ItsmeExchange"/&gt;</code></li> </ol> <p>and <code class="language-plaintext highlighter-rouge">&lt;ClaimsExchange Id="FacebookExchange" TechnicalProfileReferenceId="Facebook-OAUTH" /&gt;</code> with <code class="language-plaintext highlighter-rouge">&lt;ClaimsExchange Id="ItsmeExchange" TechnicalProfileReferenceId="ItsmeProfile" /&gt;</code></p> <h4 id="persist-custom-claims-in-aad"> <a href="#persist-custom-claims-in-aad" class="anchor-heading" aria-labelledby="persist-custom-claims-in-aad"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Persist Custom Claims in AAD </h4> <ol> <li>Edit the TrustFrameworkBase.xml document.</li> <li>Add in the section <code class="language-plaintext highlighter-rouge">&lt;ClaimsSchema&gt;</code> element the follow <code class="language-plaintext highlighter-rouge">&lt;ClaimType&gt;</code> element</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;ClaimType Id="extension_BENationalNumber"&gt;
 &lt;DisplayName&gt;Belgian National Number of the user provided by itsme&lt;/DisplayName&gt;
 &lt;DataType&gt;string&lt;/DataType&gt;
 &lt;UserInputType&gt;TextBox&lt;/UserInputType&gt;
&lt;/ClaimType&gt;

&lt;ClaimType Id="extension_phoneNumberVerified"&gt;
  &lt;DisplayName&gt;phone_number_verified&lt;/DisplayName&gt;
  &lt;DataType&gt;boolean&lt;/DataType&gt;
  &lt;UserInputType&gt;TextBox&lt;/UserInputType&gt;
&lt;/ClaimType&gt;  
</code></pre></div></div> <ol> <li>Add in the &lt;TechnicalProfile Id=”AAD-Common”&gt; the Metadata information. The values can be found as follows: <ul> <li>In Azure AD B2C, select App registrations, and then select All Applications.</li> <li>Select the b2c-extensions-app. Do not modify. Used by AADB2C for storing user data. application.</li> </ul> </li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;!-- CUSTOM --&gt;
&lt;Metadata&gt;
  &lt;Item Key="ApplicationObjectId"&gt;ObjectID of b2c-extensions-app&lt;/Item&gt;
  &lt;Item Key="ClientId"&gt;Application/ClientID of b2c-extensions-app&lt;/Item&gt;
&lt;/Metadata&gt;
</code></pre></div></div> <ol> <li>Next, in the section <PersistedClaims> add the custom claim link.</PersistedClaims></li> <li>Depending on your needs, you might need to add the custom claims in other <TechnicalProfiles> as well. For example, to Write the value in the AAD, as well as to read it back from the AAD.</TechnicalProfiles></li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;TechnicalProfile Id="AAD-Common"&gt;
 &lt;DisplayName&gt;Azure Active Directory&lt;/DisplayName&gt;
[…]
 &lt;TechnicalProfile Id="AAD-UserWriteUsingAlternativeSecurityId"&gt;
[…]
   &lt;PersistedClaims&gt;
[…]
     &lt;!-- Optional claims --&gt;
     &lt;PersistedClaim ClaimTypeReferenceId="otherMails" /&gt;
     &lt;PersistedClaim ClaimTypeReferenceId="givenName" /&gt;
     &lt;PersistedClaim ClaimTypeReferenceId="surname" /&gt;
     &lt;PersistedClaim ClaimTypeReferenceId="extension_BENationalNumber" DefaultValue="Unknown" /&gt;
     &lt;PersistedClaim ClaimTypeReferenceId="extension_phoneNumberVerified" DefaultValue="false" /&gt;
   &lt;/PersistedClaims&gt;
[…]
&lt;TechnicalProfile Id="AAD-UserReadUsingAlternativeSecurityId"&gt;
[…]
    &lt;!-- Optional claims --&gt;
    &lt;OutputClaim ClaimTypeReferenceId="userPrincipalName" /&gt;
    &lt;OutputClaim ClaimTypeReferenceId="surname" /&gt;
    &lt;OutputClaim ClaimTypeReferenceId="extension_BENationalNumber" /&gt;
</code></pre></div></div> <h4 id="edit-the-signuporsigninxml"> <a href="#edit-the-signuporsigninxml" class="anchor-heading" aria-labelledby="edit-the-signuporsigninxml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Edit the SignUpOrSignin.xml </h4> <p>In the <OutputClaims>, add the custom claim(s) to have been requested.</OutputClaims></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;OutputClaim ClaimTypeReferenceId="extension_BENationalNumber"/&gt;
&lt;OutputClaim ClaimTypeReferenceId="extension_phoneNumberVerified" /&gt;
</code></pre></div></div> <h4 id="upload-the-policies"> <a href="#upload-the-policies" class="anchor-heading" aria-labelledby="upload-the-policies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Upload the policies </h4> <ol> <li>Select the Identity Experience Framework</li> <li>Select Upload custom policy.</li> <li>In this order, upload the policy files: <ul> <li>TrustFrameworkBase.xml</li> <li>TrustFrameworkExtensions.xml</li> <li>SignUpOrSignin.xml</li> <li>ProfileEdit.xml</li> <li>PasswordReset.xml</li> </ul> </li> </ol> <h4 id="test-the-flow"> <a href="#test-the-flow" class="anchor-heading" aria-labelledby="test-the-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test the flow </h4> <ol> <li>In the Identity Experience Framework, click on the B2C_1A_signup_sigin custom policy file.</li> <li>Select Application and the reply url</li> <li>Click on Run now</li> <li>Based on your <UserJourneys>, the itsme® “Identify yourself” page will appear.</UserJourneys></li> <li>Enter your mobile phone number and click on send.</li> <li>Confirm the action in the itsme® app.</li> <li>If all succeeds, you will be redirected to the redirect URL.</li> </ol> <h2 id="reference"> <a href="#reference" class="anchor-heading" aria-labelledby="reference"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Reference </h2> <p><button type="button"><a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/partner-itsme" target="blank">Configure itsme® OpenID Connect (OIDC) with Azure Active Directory B2C</a></button> <button type="button"><a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/b2clogin#change-identity-provider-redirect-urls" target="blank">Azure B2C documentation for redirect format</a></button></p> </div> </div> <div class="search-overlay"></div> </div> <script src="../public/js/tabs.js"></script> </body> </html>
